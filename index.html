<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameTorrent - –õ—É—á—à–∏–µ –∏–≥—Ä—ã —á–µ—Ä–µ–∑ —Ç–æ—Ä—Ä–µ–Ω—Ç</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: #0f0f1b;
            color: #ffffff;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* –í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        /* ... */

        /* –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª—å –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ */
        .sync-status {
            text-align: center;
            margin-top: 10px;
            font-size: 12px;
            color: #05d9e8;
        }

        .sync-error {
            color: #ff2a6d;
        }

        .loading {
            color: #ffd700;
        }
    </style>
</head>
<body>
    <!-- –í—Å—è –ø—Ä–µ–¥—ã–¥—É—â–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞, —à–∞–ø–∫–∞, –∏–≥—Ä—ã –∏ —Ç.–¥. -->

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è GitHub Gist —Å –¢–í–û–ò–ú ID!
        const GIST_CONFIG = {
            GIST_ID: 'a436e46e9609a0beb1123d4137227931', // –¢–í–û–ô GIST ID!
            FILENAME: 'gametorrent_ratings.json',
            GITHUB_TOKEN: null
        };

        // –î–∞–Ω–Ω—ã–µ –∏–≥—Ä (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        const gamesData = [
            {
                id: 'cyberpunk',
                name: 'Cyberpunk 2077',
                year: 2020,
                size: '65.2 GB',
                genre: 'RPG',
                description: '–†–æ–ª–µ–≤–∞—è –∏–≥—Ä–∞ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –º–∏—Ä–µ –æ—Ç —Å–æ–∑–¥–∞—Ç–µ–ª–µ–π The Witcher.',
                image: 'images/–û–±–ª–æ–∂–∫–∞_–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–π_–∏–≥—Ä—ã_Cyberpunk_2077.jpg',
                torrent: 'torrents/cyberpunk-2077.torrent',
                rating: '4.8/5'
            },
            {
                id: 'elden',
                name: 'Elden Ring',
                year: 2022,
                size: '48.3 GB',
                genre: 'RPG',
                description: '–§—ç–Ω—Ç–µ–∑–∏–π–Ω–∞—è —Ä–æ–ª–µ–≤–∞—è –∏–≥—Ä–∞ –æ—Ç —Å–æ–∑–¥–∞—Ç–µ–ª–µ–π Dark Souls.',
                image: 'images/Elden_Ring_-_cover.jpg',
                torrent: 'torrents/Elden-Ring-by-Igruha.torrent',
                rating: '4.9/5'
            },
            {
                id: 'witcher',
                name: 'The Witcher 3: Wild Hunt',
                year: 2015,
                size: '35.1 GB',
                genre: 'RPG',
                description: '–≠–ø–∏—á–µ—Å–∫–∞—è —Ä–æ–ª–µ–≤–∞—è –∏–≥—Ä–∞ –≤ —Ñ—ç–Ω—Ç–µ–∑–∏–π–Ω–æ–º –º–∏—Ä–µ.',
                image: 'images/The_Witcher_3-_Wild_Hunt_Cover.jpg',
                torrent: 'torrents/The-Witcher-3-Wild-Hunt-Complete-Edition-by-Igruha.torrent',
                rating: '4.9/5'
            },
            {
                id: 'reddead',
                name: 'Red Dead Redemption 2',
                year: 2019,
                size: '109 GB',
                genre: '–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è',
                description: '–ü—Ä–∏–∫–ª—é—á–µ–Ω—á–µ—Å–∫–∏–π –≤–µ—Å—Ç–µ—Ä–Ω –æ—Ç —Å–æ–∑–¥–∞—Ç–µ–ª–µ–π GTA V.',
                image: 'images/Red_Dead_Redemption_2_coverart.jpg',
                torrent: 'torrents/red-dead-redemption-2-by-xatab.torrent',
                rating: '4.8/5'
            },
            {
                id: 'metalgear',
                name: 'Metal Gear Rising: Revengeance',
                year: 2013,
                size: '25 GB',
                genre: '–≠–∫—à–µ–Ω',
                description: '–≠–∫—à–µ–Ω —Å –º–µ—Ö–∞–Ω–∏–∫–æ–π —Ä–∞–∑—Ä–µ–∑–∞–Ω–∏—è –≤—Å–µ–≥–æ –Ω–∞ —á–∞—Å—Ç–∏. –†–ï–ñ–ò –ò –†–£–ë–ò!',
                image: 'images/Metal_Gear_Rising_Revengeance_box_artwork.jpg',
                torrent: 'torrents/Metal-Gear-Rising-Revengeance-by-Igruha.torrent',
                rating: '4.5/5'
            },
            {
                id: 'devilmaycry',
                name: 'Devil May Cry 5',
                year: 2019,
                size: '35 GB',
                genre: '–≠–∫—à–µ–Ω',
                description: '–ö—É–ª—å—Ç–æ–≤—ã–π —Å–ª—ç—à–µ—Ä —Å —Ç—Ä–µ–º—è –ø—Ä–æ—Ç–∞–≥–æ–Ω–∏—Å—Ç–∞–º–∏. –°–¢–ò–õ–¨–ù–´–ï –ö–û–ú–ë–û!',
                image: 'images/DevilMayCry5.jpg',
                torrent: 'torrents/Devil-May-Cry-5-by-Igruha.torrent',
                rating: '4.6/5'
            },
            {
                id: 'counterstrike',
                name: 'Counter-Strike 1.6',
                year: 2003,
                size: '0.5 GB',
                genre: '–®—É—Ç–µ—Ä—ã',
                description: '–ö—É–ª—å—Ç–æ–≤—ã–π —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —à—É—Ç–µ—Ä. –õ–ï–ì–ï–ù–î–ê –ö–ò–ë–ï–†–°–ü–û–†–¢–ê!',
                image: 'images/Counter-Strike_Box_1.jpg',
                torrent: 'torrents/Counter-strike-1.6.torrent',
                rating: '4.3/5'
            },
            {
                id: 'left4dead',
                name: 'Left 4 Dead 2',
                year: 2009,
                size: '8 GB',
                genre: '–®—É—Ç–µ—Ä—ã',
                description: '–ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –∑–æ–º–±–∏-—à—É—Ç–µ—Ä –æ—Ç Valve.',
                image: 'images/capsule_616x353.jpg',
                torrent: 'torrents/Left-4-Dead-2-by-Igruha.torrent',
                rating: '4.4/5'
            },
            {
                id: 'halflife',
                name: 'Half-Life',
                year: 1998,
                size: '0.5 GB',
                genre: '–®—É—Ç–µ—Ä—ã',
                description: '–õ–ï–ì–ï–ù–î–ê–†–ù–´–ô –®–£–¢–ï–† –û–¢ VALVE! –ù–∞—á–∞–ª–æ –∏—Å—Ç–æ—Ä–∏–∏ –ì–æ—Ä–¥–æ–Ω–∞ –§—Ä–∏–º–µ–Ω–∞.',
                image: 'images/capsule_616x354.jpg',
                torrent: 'torrents/Half-Life.torrent',
                rating: '4.2/5'
            },
            {
                id: 'halflife2',
                name: 'Half-Life 2',
                year: 2004,
                size: '4.5 GB',
                genre: '–®—É—Ç–µ—Ä—ã',
                description: '–®–ï–î–ï–í–† –û–¢ VALVE! –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ª–µ–≥–µ–Ω–¥—ã —Å –≥—Ä–∞–≤–∏–ø—É—à–∫–æ–π!',
                image: 'images/HL2box.jpg',
                torrent: 'torrents/Half-Life-2-Complete-Edition-by-Igruha.torrent',
                rating: '4.8/5'
            }
        ];

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let siteStats = {
            totalRating: 0,
            voteCount: 0,
            averageRating: 0,
            userRatings: {},
            comments: [],
            lastUpdate: new Date().toISOString()
        };

        let gameDownloads = {};
        let currentUser = null;
        let users = [];

        // ==================== GITHUB GIST –§–£–ù–ö–¶–ò–ò ====================

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Gist
        const loadFromGist = async () => {
            try {
                showSyncStatus('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...', 'loading');
                
                const response = await fetch(`https://api.github.com/gists/${GIST_CONFIG.GIST_ID}`);
                
                if (!response.ok) {
                    throw new Error('Gist –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
                
                const gistData = await response.json();
                const content = gistData.files[GIST_CONFIG.FILENAME].content;
                
                const remoteData = JSON.parse(content);
                
                // –û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                siteStats = {...siteStats, ...remoteData.siteStats};
                gameDownloads = {...gameDownloads, ...remoteData.gameDownloads};
                
                showSyncStatus('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã ‚úì', 'success');
                return true;
                
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ Gist:', error);
                showSyncStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
                return false;
            }
        };

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ Gist
        const saveToGist = async () => {
            try {
                showSyncStatus('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...', 'loading');
                
                const dataToSave = {
                    siteStats: {
                        ...siteStats,
                        lastUpdate: new Date().toISOString()
                    },
                    gameDownloads,
                    schemaVersion: '1.0'
                };

                const updateData = {
                    files: {
                        [GIST_CONFIG.FILENAME]: {
                            content: JSON.stringify(dataToSave, null, 2)
                        }
                    }
                };

                const response = await fetch(`https://api.github.com/gists/${GIST_CONFIG.GIST_ID}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify(updateData)
                });

                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                }

                showSyncStatus('–î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã ‚úì', 'success');
                return true;
                
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Gist:', error);
                showSyncStatus('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏', 'error');
                
                // Fallback –Ω–∞ localStorage
                saveToLocalStorage();
                return false;
            }
        };

        // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (fallback)
        const saveToLocalStorage = () => {
            try {
                localStorage.setItem('gameTorrentSiteRating', JSON.stringify(siteStats));
                localStorage.setItem('gameTorrentDownloads', JSON.stringify(gameDownloads));
                localStorage.setItem('gameTorrentUsers', JSON.stringify(users));
                if (currentUser) {
                    localStorage.setItem('gameTorrentCurrentUser', JSON.stringify(currentUser));
                }
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
            }
        };

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        const showSyncStatus = (message, type = 'info') => {
            let statusElement = document.getElementById('syncStatus');
            if (!statusElement) {
                statusElement = document.createElement('div');
                statusElement.id = 'syncStatus';
                statusElement.className = 'sync-status';
                document.querySelector('.site-rating').appendChild(statusElement);
            }
            
            statusElement.textContent = message;
            statusElement.className = `sync-status ${type === 'error' ? 'sync-error' : type === 'loading' ? 'loading' : ''}`;
            
            if (type !== 'loading') {
                setTimeout(() => {
                    statusElement.textContent = '';
                }, 3000);
            }
        };

        // ==================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        const initializeData = async () => {
            gamesData.forEach(game => {
                gameDownloads[game.id] = gameDownloads[game.id] || 0;
            });

            try {
                const gistLoaded = await loadFromGist();
                
                if (!gistLoaded) {
                    const savedStats = localStorage.getItem('gameTorrentSiteRating');
                    const savedDownloads = localStorage.getItem('gameTorrentDownloads');
                    const savedUsers = localStorage.getItem('gameTorrentUsers');
                    const currentUserData = localStorage.getItem('gameTorrentCurrentUser');
                    
                    if (savedStats) {
                        const parsed = JSON.parse(savedStats);
                        siteStats = {...siteStats, ...parsed};
                    }
                    if (savedDownloads) {
                        const parsed = JSON.parse(savedDownloads);
                        gameDownloads = {...gameDownloads, ...parsed};
                    }
                    if (savedUsers) {
                        users = JSON.parse(savedUsers);
                    }
                    if (currentUserData) {
                        currentUser = JSON.parse(currentUserData);
                    }
                }
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö');
            }
        };

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        const saveData = async () => {
            await saveToGist();
        };

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–≥—Ä
        const renderGames = (games = gamesData) => {
            const gamesGrid = document.getElementById('gamesGrid');
            gamesGrid.innerHTML = '';

            games.forEach(game => {
                const gameCard = `
                    <div class="game-card" data-game="${game.id}">
                        <img src="${game.image}" alt="${game.name}" class="game-img">
                        <div class="game-info">
                            <h3 class="game-title">${game.name}</h3>
                            <div class="game-meta">
                                <span class="game-year">${game.year}</span>
                                <span class="game-genre">${game.genre}</span>
                                <span class="game-size">${game.size}</span>
                            </div>
                            <p class="game-description">${game.description}</p>
                            <div class="game-stats">
                                <div class="rating">
                                    <span class="stars">${getStarsFromRating(game.rating)}</span>
                                    <span>${game.rating}</span>
                                </div>
                                <div class="downloads">
                                    <span>üì• <span id="downloads-${game.id}">${gameDownloads[game.id] || 0}</span></span>
                                </div>
                            </div>
                            <a href="#" class="download-btn" onclick="return downloadGame('${game.id}')">–°–∫–∞—á–∞—Ç—å —Ç–æ—Ä—Ä–µ–Ω—Ç</a>
                        </div>
                    </div>
                `;
                gamesGrid.innerHTML += gameCard;
            });
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–≤–µ–∑–¥ –∏–∑ —Ä–µ–π—Ç–∏–Ω–≥–∞
        const getStarsFromRating = (rating) => {
            const num = parseFloat(rating);
            const fullStars = Math.floor(num);
            const hasHalfStar = num % 1 >= 0.5;
            let stars = '‚òÖ'.repeat(fullStars);
            if (hasHalfStar) stars += '¬Ω';
            stars += '‚òÜ'.repeat(5 - fullStars - (hasHalfStar ? 1 : 0));
            return stars;
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è
        const getVotesText = (count) => {
            if (count === 0) return '–≥–æ–ª–æ—Å–æ–≤';
            if (count % 10 === 1 && count % 100 !== 11) return '–≥–æ–ª–æ—Å';
            if (count % 10 >= 2 && count % 10 <= 4 && (count % 100 < 10 || count % 100 >= 20)) return '–≥–æ–ª–æ—Å–∞';
            return '–≥–æ–ª–æ—Å–æ–≤';
        };

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–≤–µ–∑–¥ —Ä–µ–π—Ç–∏–Ω–≥–∞
        const getStars = (rating) => {
            if (rating === 0) return '‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ';
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            let stars = '‚òÖ'.repeat(fullStars);
            if (hasHalfStar) stars += '¬Ω';
            stars += '‚òÜ'.repeat(5 - fullStars - (hasHalfStar ? 1 : 0));
            return stars;
        };

        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ—Ä—Ä–µ–Ω—Ç-—Ñ–∞–π–ª–∞
        const createTorrentFile = (gameName, gameId) => {
            const torrentContent = `d8:announce41:http://tracker.gametorrent.com:8080/announce13:announce-listll41:http://tracker.gametorrent.com:8080/announceel44:udp://tracker.gametorrent.com:8080/announceee7:comment35:Downloaded from GameTorrent - Best Games!10:created by13:GameTorrent v1.013:creation datei${Math.floor(Date.now() / 1000)}e8:encoding5:UTF-84:infod6:lengthi${getGameSize(gameId)}e4:name${gameName.length}:${gameName}12:piece lengthi262144e6:pieces20:aaaaaaaaaaaaaaaaaaaaee`;
            
            const blob = new Blob([torrentContent], { type: 'application/x-bittorrent' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `${gameName}.torrent`;
            document.body.appendChild(a);
            a.click();
            
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –∏–≥—Ä—ã
        const getGameSize = (gameId) => {
            const sizes = {
                cyberpunk: 65.2 * 1024 * 1024 * 1024,
                elden: 48.3 * 1024 * 1024 * 1024,
                witcher: 35.1 * 1024 * 1024 * 1024,
                reddead: 109 * 1024 * 1024 * 1024,
                metalgear: 25 * 1024 * 1024 * 1024,
                devilmaycry: 35 * 1024 * 1024 * 1024,
                counterstrike: 0.5 * 1024 * 1024 * 1024,
                left4dead: 8 * 1024 * 1024 * 1024,
                halflife: 0.5 * 1024 * 1024 * 1024,
                halflife2: 4.5 * 1024 * 1024 * 1024
            };
            return sizes[gameId] || 1024 * 1024 * 1024;
        };

        // –§—É–Ω–∫—Ü–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∏–≥—Ä—ã
        const downloadGame = async (gameId) => {
            if (gameDownloads[gameId] !== undefined) {
                gameDownloads[gameId]++;
                
                await saveData();
                updateStats();

                const game = gamesData.find(g => g.id === gameId);
                const gameName = game.name;
                
                alert(`–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ "${gameName}"! üéÆ\n–°–∫–∞—á–∞–Ω–æ —Ä–∞–∑: ${gameDownloads[gameId]}`);
                
                createTorrentFile(gameName, gameId);
            }

            return false;
        };

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        const updateStats = () => {
            Object.keys(gameDownloads).forEach(game => {
                const element = document.getElementById(`downloads-${game}`);
                if (element) {
                    element.textContent = gameDownloads[game];
                }
            });

            const ratingElement = document.getElementById('siteRating');
            const votesElement = document.getElementById('siteVotes');
            const starsElement = document.getElementById('siteStars');
            
            if (ratingElement) ratingElement.textContent = siteStats.averageRating.toFixed(1);
            if (votesElement) votesElement.textContent = `${siteStats.voteCount} ${getVotesText(siteStats.voteCount)}`;
            if (starsElement) starsElement.innerHTML = getStars(siteStats.averageRating);

            updateComments();
            updateAuthUI();

            if (siteStats.lastUpdate) {
                const updateTime = new Date(siteStats.lastUpdate).toLocaleString('ru-RU');
                showSyncStatus(`–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${updateTime}`, 'info');
            }
        };

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
        const updateComments = () => {
            const commentsList = document.getElementById('commentsList');
            commentsList.innerHTML = '';

            if (siteStats.comments.length === 0) {
                commentsList.innerHTML = '<div class="no-comments">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</div>';
                return;
            }

            const sortedComments = [...siteStats.comments].sort((a, b) => 
                new Date(b.timestamp) - new Date(a.timestamp)
            ).slice(0, 5);

            sortedComments.forEach(comment => {
                const commentElement = `
                    <div class="comment">
                        <div class="comment-header">
                            <span class="comment-author">${comment.username}</span>
                            <span class="comment-rating">${'‚òÖ'.repeat(comment.rating)}${'‚òÜ'.repeat(5-comment.rating)}</span>
                        </div>
                        <div class="comment-text">${comment.text}</div>
                        <div style="font-size: 12px; color: #666687; margin-top: 5px;">${comment.date}</div>
                    </div>
                `;
                commentsList.innerHTML += commentElement;
            });
        };

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        const updateAuthUI = () => {
            const authButtons = document.getElementById('authButtons');
            const userInfo = document.getElementById('userInfo');
            const userName = document.getElementById('userName');
            const rateSection = document.getElementById('rateSection');
            const authRequired = document.getElementById('authRequired');
            const commentForm = document.getElementById('commentForm');

            if (currentUser) {
                authButtons.style.display = 'none';
                userInfo.style.display = 'flex';
                userName.textContent = currentUser.username;
                rateSection.style.display = 'block';
                authRequired.style.display = 'none';
                commentForm.style.display = 'block';

                if (siteStats.userRatings[currentUser.id]) {
                    const buttons = document.querySelectorAll('.rate-btn');
                    buttons.forEach(btn => {
                        btn.disabled = true;
                        btn.style.background = '#1a1a2e';
                        btn.style.color = '#666687';
                        btn.style.cursor = 'not-allowed';
                    });
                    document.getElementById('alreadyRated').style.display = 'block';
                    document.getElementById('userRatingInfo').style.display = 'block';
                    document.getElementById('userRatingValue').textContent = siteStats.userRatings[currentUser.id] + ' –∑–≤–µ–∑–¥';
                } else {
                    document.getElementById('alreadyRated').style.display = 'none';
                    document.getElementById('userRatingInfo').style.display = 'none';
                }
            } else {
                authButtons.style.display = 'flex';
                userInfo.style.display = 'none';
                rateSection.style.display = 'none';
                authRequired.style.display = 'block';
                commentForm.style.display = 'none';
            }
        };

        // –§—É–Ω–∫—Ü–∏—è –æ—Ü–µ–Ω–∫–∏ —Å–∞–π—Ç–∞
        const rateSite = async (rating) => {
            if (!currentUser) {
                alert('–î–ª—è –æ—Ü–µ–Ω–∫–∏ —Å–∞–π—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è!');
                showLogin();
                return;
            }

            if (siteStats.userRatings[currentUser.id]) {
                alert('–í—ã —É–∂–µ –æ—Ü–µ–Ω–∏–ª–∏ –Ω–∞—à —Å–∞–π—Ç! –°–ø–∞—Å–∏–±–æ! ‚ù§Ô∏è');
                return;
            }
            
            siteStats.userRatings[currentUser.id] = rating;
            
            const ratings = Object.values(siteStats.userRatings);
            siteStats.totalRating = ratings.reduce((sum, r) => sum + r, 0);
            siteStats.voteCount = ratings.length;
            siteStats.averageRating = siteStats.totalRating / siteStats.voteCount;
            
            await saveData();
            updateStats();
            
            alert(`–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à—É –æ—Ü–µ–Ω–∫—É ${rating} –∑–≤–µ–∑–¥! ‚≠ê\n–¢–µ–ø–µ—Ä—å –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–≤–∏–¥—è—Ç –≤–∞—à –≤–∫–ª–∞–¥!\n\n–û–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥ —Å–∞–π—Ç–∞: ${siteStats.averageRating.toFixed(1)}/5`);
        };

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        const submitComment = async () => {
            if (!currentUser) {
                alert('–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–∑—ã–≤–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è!');
                showLogin();
                return;
            }

            const commentText = document.getElementById('commentText').value.trim();
            if (!commentText) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞!');
                return;
            }

            const userRating = siteStats.userRatings[currentUser.id];
            if (!userRating) {
                alert('–°–Ω–∞—á–∞–ª–∞ –æ—Ü–µ–Ω–∏—Ç–µ —Å–∞–π—Ç!');
                return;
            }

            const comment = {
                username: currentUser.username,
                rating: userRating,
                text: commentText,
                date: new Date().toLocaleDateString('ru-RU'),
                timestamp: new Date().toISOString()
            };

            siteStats.comments.push(comment);
            await saveData();
            updateStats();

            document.getElementById('commentText').value = '';
            alert('–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –æ—Ç–∑—ã–≤! ‚ù§Ô∏è –¢–µ–ø–µ—Ä—å –µ–≥–æ —É–≤–∏–¥—è—Ç –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏!');
        };

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        const showLogin = () => {
            document.getElementById('loginModal').style.display = 'block';
        };

        const showRegister = () => {
            document.getElementById('registerModal').style.display = 'block';
        };

        const closeModal = (modalId) => {
            document.getElementById(modalId).style.display = 'none';
        };

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('regUsername').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const password = document.getElementById('regPassword').value.trim();

            if (users.find(user => user.email === email)) {
                alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
                return;
            }

            const newUser = {
                id: 'user_' + Math.random().toString(36).substr(2, 9),
                username: username,
                email: email,
                password: password
            };

            users.push(newUser);
            currentUser = newUser;
            saveToLocalStorage(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ª–æ–∫–∞–ª—å–Ω–æ
            updateAuthUI();
            closeModal('registerModal');
            
            alert(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${username}! üéÆ`);
        });

        // –í—Ö–æ–¥
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value.trim();

            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                saveToLocalStorage(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                updateAuthUI();
                closeModal('loginModal');
                alert(`–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º, ${user.username}! üéÆ`);
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å!');
            }
        });

        // –í—ã—Ö–æ–¥
        const logout = () => {
            currentUser = null;
            saveToLocalStorage();
            updateAuthUI();
            alert('–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞!');
        };

        // –ü–æ–∏—Å–∫ –∏–≥—Ä
        const searchGames = () => {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (!searchTerm) {
                renderGames();
                return;
            }

            const filteredGames = gamesData.filter(game => 
                game.name.toLowerCase().includes(searchTerm) ||
                game.genre.toLowerCase().includes(searchTerm) ||
                game.description.toLowerCase().includes(searchTerm)
            );

            renderGames(filteredGames);
        };

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        const filterByCategory = (category) => {
            if (category === 'all') {
                renderGames();
                return;
            }

            const filteredGames = gamesData.filter(game => game.genre === category);
            renderGames(filteredGames);
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async () => {
            await initializeData();
            renderGames();
            updateStats();
            updateAuthUI();

            // –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(async () => {
                await loadFromGist();
                updateStats();
            }, 30000);

            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchGames();
                }
            });

            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>
